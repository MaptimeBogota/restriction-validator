L.LineUtil.PolylineDecorator={computeAngle:function(d,c){return(Math.atan2(c.y-d.y,c.x-d.x)*180/Math.PI)+90},getPointPathPixelLength:function(f){var d=f.length;if(d<2){return 0}var e=0,b=f[0],c;for(var a=1;a<d;a++){e+=b.distanceTo(c=f[a]);b=c}return e},getPixelLength:function(b,g){var f=(b instanceof L.Polyline)?b.getLatLngs():b,e=f.length;if(e<2){return 0}var h=0,c=g.project(f[0]),d;for(var a=1;a<e;a++){h+=c.distanceTo(d=g.project(f[a]));c=d}return h},projectPatternOnPath:function(h,e,c,b,g){var a=[],d;for(d=0,l=h.length;d<l;d++){a[d]=g.project(h[d])}var f=this.projectPatternOnPointPath(a,e,c,b);for(d=0,l=f.length;d<l;d++){f[d].latLng=g.unproject(f[d].pt)}return f},projectPatternOnPointPath:function(j,b,g,h){var d=[];var e=this.getPointPathPixelLength(j)*h;var f=this.interpolateOnPointPath(j,b);var i=g>0?this.getPointPathPixelLength(j)*g:0;d.push(f);if(h>0){var a=j;a=a.slice(f.predecessor);a[0]=f.pt;var c=this.getPointPathPixelLength(a);while(e<=c-i){f=this.interpolateOnPointPath(a,e/c);d.push(f);a=a.slice(f.predecessor);a[0]=f.pt;c=this.getPointPathPixelLength(a)}}return d},interpolateOnPointPath:function(o,f){var m=o.length;if(m<2){return null}if(f<=0){return{pt:o[0],predecessor:0,heading:this.computeAngle(o[0],o[1])}}if(f>=1){return{pt:o[m-1],predecessor:m-1,heading:this.computeAngle(o[m-2],o[m-1])}}if(m==2){return{pt:this.interpolateBetweenPoints(o[0],o[1],f),predecessor:0,heading:this.computeAngle(o[0],o[1])}}var n=this.getPointPathPixelLength(o);var k=o[0],j=k,g=0,e=0,h=0;var c=1;for(;c<m&&e<f;c++){k=j;g=e;j=o[c];h+=k.distanceTo(j);e=h/n}var d=(f-g)/(e-g);return{pt:this.interpolateBetweenPoints(k,j,d),predecessor:c-2,heading:this.computeAngle(k,j)}},interpolateBetweenPoints:function(b,a,c){if(a.x!=b.x){return new L.Point((b.x*(1-c))+(c*a.x),(b.y*(1-c))+(c*a.y))}return new L.Point(b.x,b.y+(a.y-b.y)*c)}};L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(b,a){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,a);this._map=null;this._initPaths(b);this._initPatterns()},_initPaths:function(c){this._paths=[];var b=false;if(c instanceof L.Polyline){this._initPath(c.getLatLngs(),(c instanceof L.Polygon))}else{if(L.Util.isArray(c)&&c.length>0){if(c[0] instanceof L.Polyline){for(var a=0;a<c.length;a++){this._initPath(c[a].getLatLngs(),(c[a] instanceof L.Polygon))}}else{this._initPath(c)}}}},_isCoordArray:function(a){return(L.Util.isArray(a)&&a.length>0&&(a[0] instanceof L.LatLng||(L.Util.isArray(a[0])&&a[0].length==2&&typeof a[0][0]==="number")))},_initPath:function(d,c){var b;if(this._isCoordArray(d)){b=[d]}else{b=d}for(var a=0;a<b.length;a++){if(c){b[a].push(b[a][0])}this._paths.push(b[a])}},_initPatterns:function(){this._isZoomDependant=false;this._patterns=[];var b;for(var a=0;a<this.options.patterns.length;a++){b=this._parsePatternDef(this.options.patterns[a]);this._patterns.push(b);this._isZoomDependant=this._isZoomDependant||b.isOffsetInPixels||b.isEndOffsetInPixels||b.isRepeatInPixels||b.symbolFactory.isZoomDependant;this._isZoomDependant=false}},setPatterns:function(a){this.options.patterns=a;this._initPatterns();this._softRedraw()},setPaths:function(a){this._initPaths(a);this.redraw()},_parsePatternDef:function(a,c){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:false,isEndOffsetInPixels:false,isRepeatInPixels:false};if(typeof a.offset==="string"&&a.offset.indexOf("%")!=-1){b.offset=parseFloat(a.offset)/100}else{b.offset=a.offset?parseFloat(a.offset):0;b.isOffsetInPixels=(b.offset>0)}if(typeof a.endOffset==="string"&&a.endOffset.indexOf("%")!=-1){b.endOffset=parseFloat(a.endOffset)/100}else{b.endOffset=a.endOffset?parseFloat(a.endOffset):0;b.isEndOffsetInPixels=(b.endOffset>0)}if(typeof a.repeat==="string"&&a.repeat.indexOf("%")!=-1){b.repeat=parseFloat(a.repeat)/100}else{b.repeat=parseFloat(a.repeat);b.isRepeatInPixels=(b.repeat>0)}return(b)},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant){this._map.on("zoomend",this._softRedraw,this)}},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);this._map=null;L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(f,c,b){var d=[];for(var e=0,a=b.length;e<a;e++){d.push(c.buildSymbol(b[e],f,this._map,e,a))}return d},_getCache:function(d,c,a){var b=d.cache[c];if(typeof b==="undefined"){d.cache[c]=[];return null}return b[a]},_getDirectionPoints:function(b,g){var i=this._map.getZoom();var d=this._getCache(g,i,b);if(d){return d}var f,h,a,c=null,e=this._paths[b];if(g.isOffsetInPixels){c=L.LineUtil.PolylineDecorator.getPixelLength(e,this._map);f=g.offset/c}else{f=g.offset}if(g.isEndOffsetInPixels){c=(c!==null)?c:L.LineUtil.PolylineDecorator.getPixelLength(e,this._map);h=g.endOffset/c}else{h=g.endOffset}if(g.isRepeatInPixels){c=(c!==null)?c:L.LineUtil.PolylineDecorator.getPixelLength(e,this._map);a=g.repeat/c}else{a=g.repeat}d=L.LineUtil.PolylineDecorator.projectPatternOnPath(e,f,h,a,this._map);g.cache[i][b]=d;return d},redraw:function(){this._redraw(true)},_softRedraw:function(){this._redraw(false)},_redraw:function(b){if(this._map===null){return}this.clearLayers();if(b){for(var a=0;a<this._patterns.length;a++){this._patterns[a].cache=[]}}this._draw()},_drawPattern:function(e){var a,c;for(var d=0;d<this._paths.length;d++){a=this._getDirectionPoints(d,e);c=this._buildSymbols(this._paths[d],e.symbolFactory,a);for(var b=0;b<c.length;b++){this.addLayer(c[b])}}},_draw:function(){for(var a=0;a<this._patterns.length;a++){this._drawPattern(this._patterns[a])}}});L.polylineDecorator=function(b,a){return new L.PolylineDecorator(b,a)};L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this);this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]="50% 50%"},_setPos:function(d){L.Marker.prototype._setPos.call(this,d);if(L.DomUtil.TRANSFORM){this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)"}else{if(L.Browser.ie){var a=this.options.angle*(Math.PI/180),b=Math.cos(a),c=Math.sin(a);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+b+", M12="+(-c)+", M21="+c+", M22="+b+")"}}},setAngle:function(a){this.options.angle=a}});L.rotatedMarker=function(b,a){return new L.RotatedMarker(b,a)};L.Symbol=L.Symbol||{};L.Symbol.Dash=L.Class.extend({isZoomDependant:true,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(i,f,d,h,m){var c=this.options,g=Math.PI/180;if(c.pixelSize<=1){return new L.Polyline([i.latLng,i.latLng],c.pathOptions)}var k=d.project(i.latLng);var e=(-(i.heading-90))*g;var n=new L.Point(k.x+c.pixelSize*Math.cos(e+Math.PI)/2,k.y+c.pixelSize*Math.sin(e)/2);var j=k.add(k.subtract(n));return new L.Polyline([d.unproject(n),d.unproject(j)],c.pathOptions)}});L.Symbol.dash=function(a){return new L.Symbol.Dash(a)};L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:true,options:{polygon:false,pixelSize:10,headAngle:60,side:"both",direction:"forward",pathOptions:{stroke:false,weight:2}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(a,g,f,b,d){var c=this.options;var e;if(c.polygon){e=new L.Polygon(this._buildArrowPath(a,f),c.pathOptions)}else{e=new L.Polyline(this._buildArrowPath(a,f),c.pathOptions)}return e},_buildArrowPath:function(h,c){var e=Math.PI/180;var d=c.project(h.latLng);var i;if(this.options.direction=="forward"){var i=(-(h.heading-90))*e}else{var i=(-(h.heading+90))*e}var f=this.options.headAngle/2*e;var m=i+f,k=i-f;var b=new L.Point(d.x-this.options.pixelSize*Math.cos(m),d.y+this.options.pixelSize*Math.sin(m)),a=new L.Point(d.x-this.options.pixelSize*Math.cos(k),d.y+this.options.pixelSize*Math.sin(k));var j=[];var g=this.options.side;if(g=="both"||g=="right"){j.push(c.unproject(b))}j.push(h.latLng);if(g=="both"||g=="left"){j.push(c.unproject(a))}return j}});L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)};L.Symbol.Marker=L.Class.extend({isZoomDependant:false,options:{markerOptions:{},rotate:false},initialize:function(a){L.Util.setOptions(this,a);this.options.markerOptions.clickable=false;this.options.markerOptions.draggable=false;this.isZoomDependant=(L.Browser.ie&&this.options.rotate)},buildSymbol:function(a,e,d,b,c){if(!this.options.rotate){return new L.Marker(a.latLng,this.options.markerOptions)}else{this.options.markerOptions.angle=a.heading;return new L.RotatedMarker(a.latLng,this.options.markerOptions)}}});L.Symbol.marker=function(a){return new L.Symbol.Marker(a)};